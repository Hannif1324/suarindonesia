<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Migration - SuaR Indonesia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üì¶ Data Migration</h1>
            <p class="text-gray-600">Migrate data from static files to Supabase database</p>
        </div>

        <!-- Migration Sections -->
        <div class="space-y-4">
            <!-- Existing Migration (Berita, Kegiatan, Produk) -->
            <div class="bg-white rounded-lg shadow p-6 opacity-50">
                <h2 class="text-xl font-bold text-gray-900 mb-3">üì∞ Articles, Activities & Products</h2>
                <p class="text-gray-600 mb-4">Migrate Berita, Kegiatan, and Produk data to Supabase</p>
                <button id="migrateBtn" disabled
                    class="bg-gray-400 text-white px-6 py-3 rounded-lg cursor-not-allowed font-semibold transition">
                    Migration Unavailable (Missing Source Files)
                </button>
            </div>

            <!-- Photo Gallery Migration -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-3">üì∏ Photo Gallery</h2>
                <p class="text-gray-600 mb-2">Migrate photo gallery data to Supabase</p>
                <p class="text-sm text-gray-500 mb-4" id="photo-count">8 photos ready to migrate</p>
                <button id="migrate-photos-btn"
                    class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold transition">
                    Migrate Photos
                </button>
            </div>

            <!-- Videos Migration -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-3">üé• Videos</h2>
                <p class="text-gray-600 mb-2">Migrate videos data to Supabase</p>
                <p class="text-sm text-gray-500 mb-4" id="video-count">3 videos ready to migrate</p>
                <button id="migrate-videos-btn"
                    class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 font-semibold transition">
                    Migrate Videos
                </button>
            </div>

            <!-- Migrate All -->
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg shadow-lg p-6 text-white">
                <h2 class="text-xl font-bold mb-3">üöÄ Migrate All Kegiatan Data</h2>
                <p class="mb-4 opacity-90">Migrate both photo gallery and videos in one go</p>
                <button id="migrate-all-kegiatan-btn"
                    class="bg-white text-green-700 px-8 py-3 rounded-lg hover:bg-gray-100 font-bold transition">
                    Migrate All (Photos + Videos)
                </button>
            </div>
        </div>

        <!-- Migration Log -->
        <div id="logs"
            class="mt-6 bg-gray-900 text-green-400 font-mono text-sm p-6 rounded-lg shadow-lg h-96 overflow-y-auto">
            <div class="text-gray-500">Ready to migrate...</div>
        </div>

        <!-- Back to Admin -->
        <div class="mt-6 text-center">
            <a href="index.html" class="text-indigo-600 hover:text-indigo-800 font-medium">
                ‚Üê Back to Admin Dashboard
            </a>
        </div>
    </div>

    <script type="module">
        import { supabase } from '../js/services/supabase-client.js';

        const logsDiv = document.getElementById('logs');

        function addLog(message, type = 'info') {
            const colors = {
                'info': 'text-blue-400',
                'success': 'text-green-400',
                'warning': 'text-yellow-400',
                'error': 'text-red-400'
            };
            const color = colors[type] || 'text-gray-400';
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Embedded Data
        const kegiatanData = {
            photoGallery: [
                {
                    id: 1,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.44-YKbrRk0pQ5sbwzEn.jpeg",
                    caption: "Workshop GEDSI - BPBD Jawa Timur",
                    date: "20 April 2022",
                    category: "pelatihan"
                },
                {
                    id: 2,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.46-AVLbMknyBjhp5wGY.jpeg",
                    caption: "Pelatihan Pendidik Sebaya HIV/AIDS",
                    date: "15 Maret 2024",
                    category: "pelatihan"
                },
                {
                    id: 3,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.48-YNqrRk56qouBN31r.jpeg",
                    caption: "Sosialisasi Program Perlindungan Anak",
                    date: "10 Februari 2024",
                    category: "sosialisasi"
                },
                {
                    id: 4,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.44-1-m6LJpyKRwBhePLaz.jpeg",
                    caption: "Rapat Koordinasi Program Kebencanaan",
                    date: "5 Januari 2024",
                    category: "rapat"
                },
                {
                    id: 5,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.47-1-A854RKax9ySw0Vp5.jpeg",
                    caption: "Program Lapangan WASH",
                    date: "20 Desember 2023",
                    category: "lapangan"
                },
                {
                    id: 6,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.45-mjE9JaZ6vku541JE.jpeg",
                    caption: "Monitoring dan Evaluasi Program PTY",
                    date: "15 November 2023",
                    category: "monev"
                },
                {
                    id: 7,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.47-YNqrRk56b4iX6kZW.jpeg",
                    caption: "Kegiatan Pelatihan Komunitas",
                    date: "10 Oktober 2023",
                    category: "pelatihan"
                },
                {
                    id: 8,
                    image: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=1200,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-26-at-2.52.56-pm-YNqyEnN3M2fe3q46.jpeg",
                    caption: "Program Pemberdayaan Masyarakat",
                    date: "5 September 2023",
                    category: "lapangan"
                }
            ],
            videos: [
                {
                    id: 1,
                    title: "Profil SuaR Indonesia",
                    description: "Video profil organisasi SuaR Indonesia dan program-program yang dijalankan",
                    thumbnail: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=768,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.44-YKbrRk0pQ5sbwzEn.jpeg",
                    videoUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ",
                    duration: "5:30",
                    date: "Januari 2024"
                },
                {
                    id: 2,
                    title: "Workshop GEDSI 2022",
                    description: "Dokumentasi workshop pengarusutamaan gender dan inklusi dalam kebencanaan",
                    thumbnail: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=768,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.46-AVLbMknyBjhp5wGY.jpeg",
                    videoUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ",
                    duration: "8:45",
                    date: "April 2022"
                },
                {
                    id: 3,
                    title: "Program Perlindungan Anak",
                    description: "Kegiatan sosialisasi dan implementasi program perlindungan anak di masyarakat",
                    thumbnail: "https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=768,fit=crop/YZ9b16O2aksMXqwd/whatsapp-image-2024-09-09-at-12.34.48-YNqrRk56qouBN31r.jpeg",
                    videoUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ",
                    duration: "6:15",
                    date: "Februari 2024"
                }
            ]
        };

        class KegiatanDataMigration {
            constructor() {
                this.migrationLog = [];
            }

            log(message, type = 'info') {
                const logEntry = {
                    timestamp: new Date().toISOString(),
                    type,
                    message
                };
                this.migrationLog.push(logEntry);
                console.log(`[${type.toUpperCase()}] ${message}`);
            }

            async migratePhotoGallery() {
                this.log('Starting photo gallery migration...');

                try {
                    const photos = kegiatanData.photoGallery;
                    this.log(`Found ${photos.length} photos to migrate`);

                    const { data: existing } = await supabase
                        .from('photo_gallery')
                        .select('id');

                    if (existing && existing.length > 0) {
                        this.log(`Warning: ${existing.length} photos already exist in database`, 'warning');
                        const proceed = confirm(`${existing.length} photos already exist. Do you want to clear and re-migrate?`);

                        if (proceed) {
                            this.log('Clearing existing photo gallery data...');
                            await supabase.from('photo_gallery').delete().neq('id', 0);
                            this.log('Existing data cleared');
                        } else {
                            this.log('Migration cancelled by user', 'warning');
                            return { success: false, message: 'Cancelled by user' };
                        }
                    }

                    const photosToInsert = photos.map(photo => ({
                        image: photo.image,
                        caption: photo.caption,
                        date: photo.date,
                        category: photo.category
                    }));

                    const { data, error } = await supabase
                        .from('photo_gallery')
                        .insert(photosToInsert)
                        .select();

                    if (error) throw error;

                    this.log(`Successfully migrated ${data.length} photos`, 'success');
                    return { success: true, count: data.length, data };

                } catch (error) {
                    this.log(`Error migrating photo gallery: ${error.message}`, 'error');
                    return { success: false, error: error.message };
                }
            }

            async migrateVideos() {
                this.log('Starting videos migration...');

                try {
                    const videos = kegiatanData.videos;
                    this.log(`Found ${videos.length} videos to migrate`);

                    const { data: existing } = await supabase
                        .from('videos')
                        .select('id');

                    if (existing && existing.length > 0) {
                        this.log(`Warning: ${existing.length} videos already exist in database`, 'warning');
                        const proceed = confirm(`${existing.length} videos already exist. Do you want to clear and re-migrate?`);

                        if (proceed) {
                            this.log('Clearing existing videos data...');
                            await supabase.from('videos').delete().neq('id', 0);
                            this.log('Existing data cleared');
                        } else {
                            this.log('Migration cancelled by user', 'warning');
                            return { success: false, message: 'Cancelled by user' };
                        }
                    }

                    const videosToInsert = videos.map(video => ({
                        title: video.title,
                        description: video.description,
                        thumbnail: video.thumbnail,
                        video_url: video.videoUrl,
                        duration: video.duration,
                        date: video.date
                    }));

                    const { data, error } = await supabase
                        .from('videos')
                        .insert(videosToInsert)
                        .select();

                    if (error) throw error;

                    this.log(`Successfully migrated ${data.length} videos`, 'success');
                    return { success: true, count: data.length, data };

                } catch (error) {
                    this.log(`Error migrating videos: ${error.message}`, 'error');
                    return { success: false, error: error.message };
                }
            }

            async migrateAll() {
                this.log('=== Starting Full Migration ===');

                const results = {
                    photoGallery: await this.migratePhotoGallery(),
                    videos: await this.migrateVideos()
                };

                this.log('=== Migration Complete ===');
                this.log(`Photo Gallery: ${results.photoGallery.success ? 'SUCCESS' : 'FAILED'}`);
                this.log(`Videos: ${results.videos.success ? 'SUCCESS' : 'FAILED'}`);

                return {
                    success: results.photoGallery.success && results.videos.success,
                    results,
                    log: this.migrationLog
                };
            }
        }

        // Event Listeners
        document.getElementById('migrate-photos-btn').addEventListener('click', async () => {
            const migration = new KegiatanDataMigration();
            addLog('=== Photo Gallery Migration Started ===', 'info');

            const result = await migration.migratePhotoGallery();

            migration.migrationLog.forEach(log => {
                addLog(log.message, log.type);
            });

            if (result.success) {
                addLog(`‚úÖ Successfully migrated ${result.count} photos!`, 'success');
            } else {
                addLog(`‚ùå Photo migration failed: ${result.error || result.message}`, 'error');
            }
        });

        document.getElementById('migrate-videos-btn').addEventListener('click', async () => {
            const migration = new KegiatanDataMigration();
            addLog('=== Videos Migration Started ===', 'info');

            const result = await migration.migrateVideos();

            migration.migrationLog.forEach(log => {
                addLog(log.message, log.type);
            });

            if (result.success) {
                addLog(`‚úÖ Successfully migrated ${result.count} videos!`, 'success');
            } else {
                addLog(`‚ùå Videos migration failed: ${result.error || result.message}`, 'error');
            }
        });

        document.getElementById('migrate-all-kegiatan-btn').addEventListener('click', async () => {
            const migration = new KegiatanDataMigration();
            addLog('=== Full Kegiatan Migration Started ===', 'info');

            const result = await migration.migrateAll();

            migration.migrationLog.forEach(log => {
                addLog(log.message, log.type);
            });

            if (result.success) {
                const photoCount = result.results.photoGallery.count || 0;
                const videoCount = result.results.videos.count || 0;
                addLog(`‚úÖ Migration Complete! Photos: ${photoCount}, Videos: ${videoCount}`, 'success');
                alert(`‚úÖ Migration completed successfully!\n\nüì∏ Photos: ${photoCount}\nüé• Videos: ${videoCount}`);
            } else {
                addLog(`‚ùå Migration failed. Check logs for details.`, 'error');
                alert('‚ùå Migration failed. Check the logs for details.');
            }
        });
    </script>
</body>

</html>